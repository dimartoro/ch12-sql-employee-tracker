const inquirer = require('inquirer');
const express = require('express');
const cTable = require('console.table');
const PORT = process.env.PORT || 3001;
const app = express();

const mysql = require('mysql2/promise');
const questions = [
  {
    type:'list',
    choices:["View All Employees", "Add Employee", "Update Employee Role", "View All Roles", "Add Role", "View All Departments", "Add Department", "Quit"],
    message:'What would you like to do?',
    name:'selection',
}
];

app.use(express.urlencoded({ extended: false }));
app.use(express.json());

// const sql = `SELECT * FROM department`;
  
//   db.query(sql, (err, rows) => {
//     if (err) {
//       console.log(err);
//        return;
//     }
//     console.log(rows);
//     console.table(rows);
//   });

async function init() {
  //const a = await getDepartmentIdByName("Legal");
  questionAddRole();
}

init();

function listEmployees(){
  var sql = `SELECT * FROM employee`;
  executeScript(sql);
}


async function getDepartmentIdByName(department){
  var sql = `SELECT id FROM department where name = "${department}"`;
  await executeScript(sql).then((data)=>{
    console.log("111::", data);
    return data;
  });
}

async function saveRole(role, salary, department){
  getDepartmentIdByName(department).then((data)=>{
    console.log("Received data: ", data);
    var sql = `insert into role values("${role}", ${salary},${data})`;
    executeScript(sql);
    console.log(`The Role ${role} has been inserted succesfully`);
    listDepartments();
  });
}

async function executeScript(sql){
  console.log("SQL::::::", sql);
  const db = await mysql.createConnection(
    {
      host: 'localhost',
      // MySQL username,
      user: 'root',
      // TODO: Add MySQL password here
      password: 'diana123',
      database: 'hr_db'
    },
    console.log(`Connected to the hr_db database.`)
    );
  await db.execute(sql).then((data)=>{
    console.log("2222::::::", data);
    console.log("3333::::::", data);
    console.log("44444::::::", data);
    return data;
  });
}

function questionAddRole(){
  var insertQuestions=[
    {
      type:'input',
      message:'What is the name of the role?',
      name:'role',
    },
    {
      type:'input',
      message:'What is the salary of the role?',
      name:'salary',
    },
    {
      type:'input',
      message:'Wich department does the role belongs to?',
      name:'department',
    }
  ]

  inquirer
    .prompt(insertQuestions)
    .then((answers) =>{
        
        console.log("answsers: ", answers);
        saveRole(answers.role, answers.salary, answers.department);
    })
    .catch((error) => {
        if (error.isTtyError) {
            console.log("Prompt couldn't be rendered in the current environment.")
        } else {
          console.log("error other than prompt")
        }
    });
} 