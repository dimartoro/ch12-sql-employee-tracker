const inquirer = require('inquirer');

const express = require('express');
// Import and require mysql2
const mysql = require('mysql2');
const cTable = require('console.table');
const PORT = process.env.PORT || 3001;
const app = express();

const db = mysql.createConnection(
  {
    host: 'localhost',
    // MySQL username,
    user: 'root',
    // TODO: Add MySQL password here
    password: 'diana123',
    database: 'hr_db'
  },
);


const questions = [
  {
    type:'list',
    choices:["View All Employees", "Add Employee", "Update Employee Role", "View All Roles", "Add Role", "View All Departments", "Add Department", "Quit"],
    message:'What would you like to do?',
    name:'selection',
}
];

app.use(express.urlencoded({ extended: false }));
app.use(express.json());




function init() {
  //initialPrompt();    
  questionAddRole();
}

init();

function listEmployees(){
  var sql = `SELECT * FROM employee`;
  executeScript(sql);
}

function listRoles(){
  var sql = `SELECT * FROM role`;
  executeScript(sql);
}

function listDepartments(){
  var sql = `SELECT * FROM department`;
  var dpts = executeScript(sql);
}

function saveDepartment(deptName){
  var sql = `insert into department(name)values("${deptName}")`;
  executeScript(sql);
  listDepartments();
}

function saveRole(role, salary, department){
    var sql = `insert into role(title,salary,department_id) values("${role}", ${salary},(select id from department where name = "${department}"))`;
    executeScript(sql);
    listRoles();
}

function executeScript(sql){
  db.query(sql, (err, rows) => {
    if (err) {
      console.log(err);
       return;
    }
    console.log(rows);
    console.table(rows);
    return rows;
  });
}

function initialPrompt(){
  inquirer
    .prompt(questions)
    .then((answers) =>{
        
        console.log("answsers: ", answers);

        switch(answers.selection){
            case 'View All Employees':
            listEmployees();
            break;
            case 'View All Roles':
            listRoles();
            break;
            case 'View All Departments':
            listDepartments();
            break;
            case 'Add Department':
              questionAddDepartment();
            break;
            case 'Add Role':
              questionAddRole();
              break;
          default:
              console.log("Wrong selection.");
        };

    })
    .catch((error) => {
        if (error.isTtyError) {
            console.log("Prompt couldn't be rendered in the current environment.")
        } else {
          console.log("error other than prompt")
        }
    });
}

function questionAddDepartment(){
  var insertQuestions=[
    {
      type:'input',
      message:'What is the name of the Department?',
      name:'department',
    }
  ]
  inquirer
    .prompt(insertQuestions)
    .then((answers) =>{
        saveDepartment(answers.department)
    })
    .catch((error) => {
        if (error.isTtyError) {
            console.log("Prompt couldn't be rendered in the current environment.")
        } else {
          console.log("error other than prompt")
        }
    });
}

async function questionAddRole(){
  
  console.log("1111::::");
  var insertQuestions=[
    {
      type:'input',
      message:'What is the name of the role?',
      name:'role',
    },
    {
      type:'input',
      message:'What is the salary of the role?',
      name:'salary',
    },
    {
      type:'list',
    choices:[],
    message:'Wich department does the role belongs to?',
    name:'department',
    }
    // {
    //   type:'input',
    //   message:'Wich department does the role belongs to?',
    //   name:'department',
    // }
  ];

  inquirer
    .prompt(insertQuestions)
    .then((answers) =>{
        
        console.log("answsers: ", answers);
        saveRole(answers.role, answers.salary, answers.department);
    })
    .catch((error) => {
        if (error.isTtyError) {
            console.log("Prompt couldn't be rendered in the current environment.")
        } else {
          console.log("error other than prompt")
        }
    });
} 